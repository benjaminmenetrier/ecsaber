--- /home/benjaminm/code/oops-bundle/ecsaber/oops-patch/src/oops/base/FieldSet4D.h.tmp.bak	2023-11-15 12:23:09.405106420 +0100
+++ /home/benjaminm/code/oops-bundle/ecsaber/oops-patch/src/oops/base/FieldSet4D.h	2023-11-15 12:23:35.217153908 +0100
@@ -12,8 +12,8 @@
 
 #include "oops/base/DataSetBase.h"
 #include "oops/base/FieldSet3D.h"
-#include "oops/base/Increment4D.h"
-#include "oops/base/State4D.h"
+#include "oops/assimilation/Increment4D.h"
+#include "oops/assimilation/State4D.h"
 
 namespace oops {
 
@@ -59,11 +59,11 @@
 
 template<typename MODEL>
 FieldSet4D::FieldSet4D(const State4D<MODEL> & state4d)
-  : Base_(state4d.times(), state4d.commTime(), {0}, oops::mpi::myself()) {
-  for (size_t jj = 0; jj < state4d.size(); ++jj) {
-    this->dataset().emplace_back(new FieldSet3D(state4d[jj].fieldSet(),
+  : Base_(state4d.times(), oops::mpi::myself(), {0}, oops::mpi::myself()) {
+  for (size_t jj = 0; jj < state4d.statesNumber(); ++jj) {
+    this->dataset().emplace_back(new FieldSet3D(state4d[jj].state().fieldSet(),
                                                 state4d[jj].validTime(),
-                                                state4d.geometry().getComm()));
+                                                eckit::mpi::comm()));
   }
 }
 
@@ -71,11 +71,11 @@
 
 template<typename MODEL>
 FieldSet4D::FieldSet4D(const Increment4D<MODEL> & inc4d)
-  : Base_(inc4d.times(), inc4d.commTime(), {0}, oops::mpi::myself()) {
-  for (size_t jj = 0; jj < inc4d.size(); ++jj) {
-    this->dataset().emplace_back(new FieldSet3D(inc4d[jj].fieldSet(),
+  : Base_(inc4d.times(), oops::mpi::myself(), {0}, oops::mpi::myself()) {
+  for (size_t jj = inc4d.first(); jj <= inc4d.last(); ++jj) {
+    this->dataset().emplace_back(new FieldSet3D(inc4d[jj].increment().fieldSet(),
                                                 inc4d[jj].validTime(),
-                                                inc4d.geometry().getComm()));
+                                                eckit::mpi::comm()));
   }
 }
 
